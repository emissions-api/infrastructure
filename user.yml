---

- hosts: server
  vars:
    admins:
      - sven
      - hendrik
      - lars

  tasks:

    - name: add EPEL repository on CentOS
      become: yes
      package:
        name: epel-release
      when: ansible_distribution == 'CentOS'

    - name: install base tools
      become: true
      package:
        name:
          - vim
          - zsh
          - htop
          - iotop

    - name: ensure sudo group exists
      become: true
      group:
        name: sudo

    - name: create admin users
      become: true
      user:
        name: '{{ item }}'
        groups: sudo
        append: true
      loop: '{{ admins }}'

    - name: set up admin authorized keys
      become: true
      authorized_key:
        user: '{{ item }}'
        state: present
        key: "{{ lookup('file', 'pub-keys/{{ item }}.pub') }}"
      loop: '{{ admins }}'

    - name: allow to sudo without a password
      become: true
      copy:
        dest: /etc/sudoers.d/password-less-sudo
        mode: 0600
        content: "%sudo ALL=(ALL) NOPASSWD: ALL"
        force: yes
